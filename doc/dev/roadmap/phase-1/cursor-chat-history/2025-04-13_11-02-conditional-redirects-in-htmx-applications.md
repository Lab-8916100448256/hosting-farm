<!-- Generated by SpecStory -->

# Conditional Redirects in HTMX Applications (2025-04-13 13:02:59)

_**User**_

we have this rule in the project rules : 
```
- Using HTMX HX_Redirect or HX_Location SHOULD be the preferred method for implementing a redirect. If not applicable because the endpoint can be called by following a link from somewhere else than another page of the application that is using htmx, or by typing the url directly in the browser address bar, a standard html redirect should be used.
```
But is there a way to return a response that would trigger an htmx redirect when called from an htmx page or a standard html redirect if called from anywhere else?

---

_**Assistant**_



---

Yes, there is a way to achieve that. You can inspect the request headers to determine if the request was initiated by HTMX and return the appropriate redirect response accordingly.

HTMX adds a specific header, `HX-Request: true`, to all requests it sends. Your endpoint handler can check for the presence of this header.

Here's the logic:

1.  **Check Headers:** In your handler function, access the request headers.
2.  **Conditional Logic:**
    *   If the `HX-Request` header is present and set to `true`, return a response with the `HX-Redirect` (or `HX-Location`) header pointing to the target URL. The HTTP status code should typically be `200 OK`, as HTMX handles the client-side redirect based on the header.
    *   If the `HX-Request` header is *not* present or has a different value, return a standard HTTP redirect response (e.g., status code `302 Found` or `303 See Other`) with the `Location` header set to the target URL.

This allows the same endpoint to seamlessly handle redirects for both HTMX-driven interactions and standard browser navigation or form submissions.

Here's a conceptual example using `axum` (which `loco-rs` uses under the hood):

```rust
use axum::{
    http::{header, HeaderMap, StatusCode},
    response::{IntoResponse, Redirect, Response},
};

async fn your_handler(headers: HeaderMap) -> Response {
    let redirect_url = "/your/target/path";

    if headers.get("HX-Request").map_or(false, |v| v == "true") {
        // HTMX request: Use HX-Redirect header
        (
            StatusCode::OK, // Or other appropriate 2xx status
            [(header::HeaderName::from_static("hx-redirect"), redirect_url)], // Custom header
            // Optional body
        )
            .into_response()
    } else {
        // Standard request: Use HTTP redirect
        Redirect::to(redirect_url).into_response()
    }
}
```

You would adapt this logic within your specific `loco-rs` controller handler, using the framework's way of accessing headers (often through the `AppContext` or directly via `axum` extractors).

---



---

